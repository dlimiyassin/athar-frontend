<div class="space-y-10">

  <!-- Header -->
  <div>
    <h1 class="text-3xl font-semibold text-gray-900">
      Survey Responses
    </h1>
    <p class="text-gray-500">
      Analyze student feedback per survey.
    </p>
  </div>

  <!-- Surveys Grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    @if (loadingSurveys) {
      <p-skeleton height="7rem"></p-skeleton>
      <p-skeleton height="7rem"></p-skeleton>
      <p-skeleton height="7rem"></p-skeleton>
    }

    @for (survey of surveys; track survey.id) {
      <p-card
        class="survey-card cursor-pointer"
        (click)="selectSurvey(survey)"
        [ngClass]="{ 'active': selectedSurvey?.id === survey.id }">

        <div class="space-y-2">
          <h3 class="text-lg font-semibold text-gray-800">
            {{ survey.title }}
          </h3>

          <p class="text-sm text-gray-500">
            {{ survey.description }}
          </p>

          <div class="flex justify-between items-center pt-2">
            <span class="text-xs text-gray-400">
              {{ formatDate(survey.createdAt) }}
            </span>
            <p-tag value="Survey"></p-tag>
          </div>
        </div>

      </p-card>
    }
  </div>

  <!-- Selected Survey -->
  @if (selectedSurvey) {

    <p-divider></p-divider>

    <!-- Survey Meta -->
    <div class="space-y-1">
      <h2 class="text-2xl font-semibold text-gray-800">
        {{ selectedSurvey.title }}
      </h2>
      <p class="text-gray-500">
        {{ responses.length }} responses collected
      </p>
    </div>

    <!-- Loading Responses -->
    @if (loadingResponses) {
      <p-skeleton height="5rem"></p-skeleton>
    }

    <!-- Questions -->
    @if (!loadingResponses) {

      <p-accordion [multiple]="true">

        @for (question of selectedSurvey.questions; track question.id) {

          <p-accordion-panel [value]="question.id">

            <p-accordion-header>
              <div class="flex justify-between items-center w-full">
                <span class="font-medium text-gray-800">
                  {{ question.label }}
                </span>
                <span class="mx-4">
                    <p-tag [value]="question.type"></p-tag>
                </span>
              </div>
            </p-accordion-header>

            <p-accordion-content>

              <div class="space-y-4 py-3">

                @if (answersForQuestion(question).length === 0) {
                  <p class="text-gray-400 text-sm">
                    No responses for this question.
                  </p>
                }

                @for (answer of answersForQuestion(question); track $index) {

                  <div class="answer-card">
                    {{ answer.value }}
                  </div>

                }

              </div>

            </p-accordion-content>

          </p-accordion-panel>
        }

      </p-accordion>
    }
  }

</div>
