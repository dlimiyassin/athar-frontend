

<div class="p-6 bg-white rounded shadow-md max-w-4xl mx-auto mt-6">
  <h2 class="text-2xl font-bold mb-6">Edit Student Profile</h2>

  <form [formGroup]="studentForm" (ngSubmit)="onSubmit()" class="space-y-6">

    <!-- ===== User Info Section ===== -->
    <div class="border-b pb-4 mb-6">
      <h3 class="text-xl font-semibold mb-4">User Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block mb-1 font-medium">First Name</label>
          <input pInputText formControlName="firstName" class="w-full" />
        </div>
        <div>
          <label class="block mb-1 font-medium">Last Name</label>
          <input pInputText formControlName="lastName" class="w-full" />
        </div>
        <div>
          <label class="block mb-1 font-medium">Email</label>
          <input pInputText formControlName="email" class="w-full" />
        </div>
        <div>
          <label class="block mb-1 font-medium">Gender</label>
          <p-select [options]="genderOptions" formControlName="gender" class="w-full"></p-select>
        </div>
      </div>
    </div>

    <!-- ===== Current Diploma Section ===== -->
    <div class="border-b pb-4 mb-6">
      <h3 class="text-xl font-semibold mb-4">Current Diploma</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <p-select [options]="excludeBacLevels(studyLevels)" placeholder="Level" optionLabel="label"
                  optionValue="value" [(ngModel)]="student.academicProfile.currentDiploma.studyLevel">
        </p-select>

        <p-select [options]="universities" optionLabel="label" optionValue="value" placeholder="University"
                  [(ngModel)]="student.academicProfile.currentDiploma.university">
        </p-select>

        <p-select [options]="schools" optionLabel="label" optionValue="value" placeholder="School"
                  [(ngModel)]="student.academicProfile.currentDiploma.school">
        </p-select>

        <p-select [options]="getNonBacFieldsOfStudy(studyFields)" optionLabel="label"
                  optionValue="value" placeholder="Field of Study"
                  [(ngModel)]="student.academicProfile.currentDiploma.studyField">
        </p-select>

        <input pInputText placeholder="Diploma Title"
               [(ngModel)]="student.academicProfile.currentDiploma.title" />

        <input pInputText type="number" placeholder="Year"
               [(ngModel)]="student.academicProfile.currentDiploma.year" />

        <input pInputText type="number" placeholder="Grade"
               [(ngModel)]="student.academicProfile.currentDiploma.grade" />
      </div>
    </div>

    <!-- ===== Obtained Diplomas ===== -->
    <div class="border-b pb-4 mb-6">
      <h3 class="text-xl font-semibold mb-4">Obtained Diplomas</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <p-select [options]="studyLevels" placeholder="Level" optionLabel="label" optionValue="value"
                  [(ngModel)]="diplomaForm.studyLevel">
        </p-select>

        <p-select *ngIf="diplomaForm.studyLevel === 'BAC'" [options]="getBacOptions(studyFields)"
                  optionLabel="label" optionValue="value" placeholder="Field of Study"
                  [(ngModel)]="diplomaForm.studyField">
        </p-select>

        <input *ngIf="diplomaForm.studyLevel === 'BAC'" pInputText placeholder="School"
               [(ngModel)]="diplomaForm.school" />

        <p-select *ngIf="diplomaForm.studyLevel !== 'BAC'" [options]="universities"
                  optionLabel="label" optionValue="value" placeholder="University"
                  [(ngModel)]="diplomaForm.university">
        </p-select>

        <p-select *ngIf="diplomaForm.studyLevel !== 'BAC'" [options]="getNonBacFieldsOfStudy(studyFields)"
                  optionLabel="label" optionValue="value" placeholder="Field of Study"
                  [(ngModel)]="diplomaForm.studyField">
        </p-select>

        <p-select *ngIf="diplomaForm.studyLevel !== 'BAC'" [options]="schools"
                  optionLabel="label" optionValue="value" placeholder="School"
                  [(ngModel)]="diplomaForm.school">
        </p-select>

        <input pInputText placeholder="Diploma Title" [(ngModel)]="diplomaForm.title" />
        <input pInputText type="number" placeholder="Year" [(ngModel)]="diplomaForm.year" />
        <input pInputText type="number" placeholder="Grade" [(ngModel)]="diplomaForm.grade" />
      </div>

      <button type="button" class="px-4 py-2 bg-blue-500 text-white rounded"
              (click)="addDiploma()">Add Diploma</button>

      <p-table class="mt-4" [value]="student.academicProfile.diplomas">
        <ng-template pTemplate="header">
          <tr>
            <th>Level</th>
            <th>Field</th>
            <th>Title</th>
            <th>School</th>
            <th>University</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-d let-i="rowIndex">
          <tr>
            <td>{{ d.studyLevel }}</td>
            <td>{{ d.studyField }}</td>
            <td>{{ d.title }}</td>
            <td>{{ d.school }}</td>
            <td>{{ d.university }}</td>
            <td>
              <button type="button" class="text-red-500" (click)="removeDiploma(i)">Remove</button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- ===== Submit Button ===== -->
    <div class="flex justify-end gap-4">

      <button pButton type="submit" class="px-4 py-2 rounded bg-emerald-500 text-white" [disabled]="isLoading">
        <ng-container *ngIf="!isLoading">Save</ng-container>
        <div *ngIf="isLoading" class="spinner mr-2"></div>
      </button>
    </div>

  </form>
</div>
