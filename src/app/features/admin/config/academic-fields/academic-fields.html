<p-toast />

<div class="card space-y-4">

  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="title">Academic Profile Fields</h1>
      <p class="subtitle">
        Configure dynamic academic fields collected during student onboarding.
      </p>
    </div>

    <button
      class="primary-btn"
      (click)="addNewRow()"
      [disabled]="hasPendingNewRow()"
    >
      + Add
    </button>
  </div>

  <p-table
    [value]="fields"
    editMode="cell"
    dataKey="id"
    [tableStyle]="{ 'min-width': '70rem' }"
  >

    <ng-template pTemplate="header">
      <tr>
        <th>Name</th>
        <th>Label</th>
        <th>Type</th>
        <th class="text-center">Required</th>
        <th class="text-center">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-field>
      <tr>

        <!-- Name -->
        <td pEditableColumn>
          <input
            pInputText
            [(ngModel)]="field.name"
            (blur)="onCellEditComplete(field)"
            [ngClass]="{ 'invalid-cell': !field.name }"
          />
        </td>

        <!-- Label -->
        <td pEditableColumn>
          <input
            pInputText
            [(ngModel)]="field.label"
            (blur)="onCellEditComplete(field)"
            [ngClass]="{ 'invalid-cell': !field.label }"
          />
        </td>

        <!-- Type -->
        <td pEditableColumn>
          <p-select
            [options]="fieldTypes"
            [(ngModel)]="field.type"
            appendTo="body"
            panelStyleClass="select-up"
            (onChange)="onCellEditComplete(field)"
            [ngClass]="{ 'invalid-cell': !field.type }"
          />
        </td>

        <!-- Required -->
        <td class="text-center">
          <p-toggleswitch
            [(ngModel)]="field.required"
            (onChange)="onCellEditComplete(field)"
          />
        </td>

        <!-- Actions -->
        <td class="text-center">
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-text p-button-danger"
            (click)="deleteRow(field)"
          ></button>
        </td>

      </tr>
    </ng-template>

  </p-table>
</div>
